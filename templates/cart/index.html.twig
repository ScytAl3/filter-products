{% extends 'layouts/base.html.twig' %}

{% block title %} {{ 'title.cartpage' | trans ({}, 'navigation') }} | {{ parent() }} {% endblock %}

{% block body %}

<div>
    {# Titre de la page #}
    <div class="text-center border-bottom border-warning pt-5">
        <h1 class="text-uppercase text-center border-bottom">
            {{ 'cart.titlepage' | trans ({}, 'pagecontent') }}
        </h1>
    </div>

    {# Si le panier n'est pas vide #}
    {% if items|length > 0 %}
    {# nombre de produits dans le panier #}
    <div>
        {# Ajax: product counter template #}
        {% include 'cart/_quantity.html.twig' %}
    </div>

    {# Bouton pour vider le panier et continuer ses achats #}
    <div class="row justify-content-between mx-0">
        {# Continuer achats #}
        <a class="btn btn-info btn-sm" href="{{ path('app_product_index', {'_fragment': 'anchor-product-start'}) }}">
            <i class="fas fa-chevron-circle-left"></i>
            {{ 'cart.action_link.continue' | trans ({}, 'pagecontent') }}
        </a>
        {# Vider le panier #}
        <a class="btn btn-info btn-sm" href="{{ path('app_cart_clear') }}">
            <i class="fas fa-broom"></i>
            {{ 'cart.action_link.clear' | trans ({}, 'pagecontent') }}
        </a>
    </div>

    {# Tableau des produits dans le panier #}
    <table class="table table-striped table-sm mt-3" id="js_shopping_cart">
        {# Entête du tableau #}
        <thead class="thead-dark">
            <tr>
                <th>
                    {{ 'cart.table_header.product' | trans ({}, 'pagecontent') }}
                </th>
                <th></th>
                <th>
                    {{ 'cart.table_header.price' | trans ({}, 'pagecontent') }}
                </th>
                <th class="text-center">
                    {{ 'cart.table_header.quantity' | trans ({}, 'pagecontent') }}
                </th>
                <th class="text-right">Total</th>
                <th></th>
            </tr>
        </thead>
        {# Corps du tableau: liste des produits #}
        <tbody>
            {% for item in items %}
            <tr>
                <td colspan="2">
                    {# Photo du produit #}
                    <a href="{{ path('app_product_show', {slug: item.product.slug, id: item.product.id}) }}">
                        <img src="{{ (item.product.imageName ? vich_uploader_asset(item.product) : asset('build/images/default/placeholder.jpg')) | imagine_filter("squared_thumb_xsmall") }}"
                             alt="Image of {{item.product.title}}">
                    </a>
                    {# Nom du produit #}
                    <span class="ml-2">
                        {{ item.product.title }}
                    </span>
                </td>
                {# Prix du produit #}
                <td class="align-middle">
                    {{ item.product.price|format_currency('EUR', {fraction_digit: 2}) }}
                </td>
                {# Quantité du produit #}
                <td class="align-middle quantity-modifier text-center js-quantity-modifier"
                    data-itemid="{{ item.product.id }}">
                    {# Ajouter quantité #}
                    <a class="quantity-down text-decoration-none" href="#" data-direction="down">
                        <i class="fas fa-minus-square"></i>
                    </a>
                    {# Passage de data pour le traitement de la quantite et le message de modification#}
                    <span class="mx-2" id="js-quantity-product-{{ item.product.id }}">
                        {{ item.quantity }}
                    </span>
                    {# Retirer quantité #}
                    <a class="quantity-up text-decoration-none" href="#" data-direction="up">
                        <i class="fas fa-plus-circle"></i>
                    </a>
                </td>
                {# Montant total pour la quantité du produit #}
                <td class="align-middle text-right" id="js-montant-product-{{ item.product.id }}">
                    {{ (item.product.price * item.quantity)|format_currency('EUR', {fraction_digit: 2}) }}
                </td>
                {# Bouton pour supprimer un produit du panier #}
                <td class="align-middle text-right pr-3">
                    <a class="btn btn-danger" href="{{ path('app_cart_remove', {id: item.product.id}) }}">
                        <i class="fas fa-trash" aria-hidden="true"></i>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
        {# Calcul du montant total du panier #}
        <tfoot class="text-right">
            <tr style="height:20px;">
            </tr>
            <tr class="table-info">
                <td colspan="4">Total :</td>
                <td id="js-cart-total">
                    {{ total|format_currency('EUR', {fraction_digit: 2}) }}
                </td>
                <td></td>
            </tr>
        </tfoot>
    </table>

    {# Bouton pour continuer la validation du panier #}
    <hr class="mb-4">
    <a class="btn btn-primary btn-lg btn-block mb-5" href="{{ path('app_cart_checkout') }}" type="submit">
        {{ 'cart.button.checkout' | trans ({}, 'pagecontent') }}
    </a>

    {# Message si le panier est vide #}
    {% else %}
    <div class="alert alert-info text-center" role="alert">
        <p class="mb-0">
            {{ 'cart.no_db_result' | trans ({}, 'pagecontent') }}
        </p>
    </div>
    {% endif %}

</div>

{% endblock %}

{% block javascripts %}
{{ parent() }}
{{ encore_entry_script_tags('cart') }}
{% endblock %}