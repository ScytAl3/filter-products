{% extends 'layouts/base.html.twig' %}

{% block title %} Cart | {{ parent() }} {% endblock %}

{% block body %}

<div>
    {# Titre de la page #}
    <div class="text-center pt-5">
        <h1 class="text-uppercase text-center border-bottom">Your cart</h1>
    </div>    

    {# Si le panier n'est pas vide #}
    {% if items|length > 0 %}

        {# Ajax: product counter template #}
        <p class="text-muted text-center border-bottom border-warning pb-3" id="js-cart-quantity">
            {% include 'cart/_quantity.html.twig' %}
        </p>

        <a class="btn btn-info" href="{{ path('app_cart_clear') }}">Clear <i class="fa fa-refresh"></i></a>

        <table class="table table-striped table-sm mt-5" id="js_shopping_cart">
            <thead class="thead-dark">
                <tr>
                    <th colspan="2" class="col-3">Product</th>
                    <th class="col-2">Price</th>
                    <th class="col-4 text-center">Quantity</th>
                    <th class="col-2 text-right">Total</th>
                    <th class="col"></th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    {# Photo du produit #}
                    <td>
                        <a href="{{ path('app_product_show', {slug: item.product.slug, id: item.product.id}) }}">
                            <img src="{{ (item.product.imageName ? vich_uploader_asset(item.product) : asset('build/images/default/placeholder.jpg')) | imagine_filter("squared_thumb_xsmall") }}"
                                alt="Image of {{item.product.title}}">
                        </a>
                    </td>
                    {# Nom du produit #}
                    <td class="align-middle">
                        {{ item.product.title }}
                    </td>
                    {# Prix du produit #}
                    <td class="align-middle">
                        {{ item.product.price|format_currency('EUR', {fraction_digit: 2}) }}
                    </td>
                    {# Quantité du produit #}
                    <td class="align-middle quantity-modifier text-center js-quantity-modifier" data-itemid="{{ item.product.id }}">
                        {# Ajouter quantité #}
                        <a class="quantity-down text-decoration-none" href="#" data-direction="down">
                            <i class="fas fa-minus-square"></i>
                        </a>
                        {# Passage de data pour le traitement de la quantite et le message de modification#}
                        <span class="mx-2" id="js-quantity-product-{{ item.product.id }}">
                            {{ item.quantity }}
                        </span>
                        {# Retirer quantité #}
                        <a class="quantity-up text-decoration-none" href="#" data-direction="up">
                            <i class="fas fa-plus-circle"></i>
                        </a>
                    </td>
                    {# Montant total pour la quantité du produit #}
                    <td class="align-middle text-right" id="js-montant-product-{{ item.product.id }}">
                        {{ (item.product.price * item.quantity)|format_currency('EUR', {fraction_digit: 2}) }}
                    </td>
                    {# Bouton pour supprimer un produit du panier #}
                    <td class="align-middle text-right pr-3">
                        <a class="btn btn-danger" href="{{ path('app_cart_remove', {id: item.product.id}) }}">
                            <i class="fas fa-trash" aria-hidden="true"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot class="text-right">
                <tr style="height:20px;">
                </tr>                
                <tr  class="table-info">
                    <td colspan="4">Total :</td>
                    <td id="js-cart-total">
                        {{ total|format_currency('EUR', {fraction_digit: 2}) }}
                    </td>
                    <td></td>
                </tr>
            </tfoot>
        </table>

        {# Bouton pour continuer la validation du panier #}
        <hr class="mb-4">
        <a class="btn btn-primary btn-lg btn-block mb-5" href="{{ path('app_cart_checkout') }}" type="submit">
            Continue to checkout
        </a>

    {# Message si le panier est vide #}
    {% else %}        
        <div class="alert alert-info text-center" role="alert">
            <p class="mb-0">You don't have any products in your shopping cart yet.</p>
        </div>        
    {% endif %}

</div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('cart') }}
{% endblock %}